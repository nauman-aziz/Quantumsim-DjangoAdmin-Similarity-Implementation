{% extends "admin/change_list.html" %}
{% load static %}

{% block extrahead %}
{{ block.super }}
<script>
window.applyFilters = function() {
  const table = document.querySelector('#result_list');
  if (!table) return;
  
  const rows = table.querySelectorAll('tbody tr');
  const filters = [];
  
  document.querySelectorAll('.filter-row').forEach(row => {
    const column = row.querySelector('.filter-column').value;
    const operator = row.querySelector('.filter-operator').value;
    const value = row.querySelector('.filter-value').value.toLowerCase();
    
    if (column !== '' && operator && (value || operator === 'empty' || operator === 'not_empty')) {
      filters.push({ column: parseInt(column), operator, value });
    }
  });
  
  rows.forEach(row => {
    let showRow = true;
    
    filters.forEach(filter => {
      const cell = row.cells[filter.column];
      if (!cell) return;
      
      const cellText = cell.textContent.toLowerCase().trim();
      const cellValue = parseFloat(cellText) || 0;
      
      switch (filter.operator) {
        case 'include':
          if (!cellText.includes(filter.value)) showRow = false;
          break;
        case 'exclude':
          if (cellText.includes(filter.value)) showRow = false;
          break;
        case 'lt':
          if (cellValue >= parseFloat(filter.value)) showRow = false;
          break;
        case 'lte':
          if (cellValue > parseFloat(filter.value)) showRow = false;
          break;
        case 'gt':
          if (cellValue <= parseFloat(filter.value)) showRow = false;
          break;
        case 'gte':
          if (cellValue < parseFloat(filter.value)) showRow = false;
          break;
        case 'empty':
          if (cellText !== '') showRow = false;
          break;
        case 'not_empty':
          if (cellText === '') showRow = false;
          break;
      }
    });
    
    row.style.display = showRow ? '' : 'none';
  });
};

window.resetFilters = function() {
  document.querySelectorAll('.filter-column, .filter-operator, .filter-value').forEach(el => {
    if (el.tagName === 'SELECT') el.selectedIndex = 0;
    if (el.tagName === 'INPUT') el.value = '';
  });
  
  const table = document.querySelector('#result_list');
  if (table) {
    table.querySelectorAll('tbody tr').forEach(row => {
      row.style.display = '';
    });
  }
  
  // Remove extra filter rows
  const container = document.getElementById('filters-container');
  const filterRows = container.querySelectorAll('.filter-row');
  for (let i = 1; i < filterRows.length; i++) {
    filterRows[i].remove();
  }
};

// Column visibility functions
document.addEventListener('DOMContentLoaded', function() {
  const selectAllCheckbox = document.getElementById('select-all-columns');
  const columnToggles = document.querySelectorAll('.column-toggle');
  
  // Select all toggle
  if (selectAllCheckbox) {
    selectAllCheckbox.addEventListener('change', function() {
      columnToggles.forEach(toggle => {
        toggle.checked = this.checked;
        toggleColumn(toggle.dataset.column, this.checked);
      });
    });
  }
  
  // Individual column toggles
  columnToggles.forEach(toggle => {
    toggle.addEventListener('change', function() {
      toggleColumn(this.dataset.column, this.checked);
      
      // Update select all checkbox
      const allChecked = Array.from(columnToggles).every(t => t.checked);
      selectAllCheckbox.checked = allChecked;
    });
  });
});

function toggleColumn(columnIndex, show) {
  const table = document.querySelector('#result_list');
  if (!table) return;
  
  const colIndex = parseInt(columnIndex) ; 
  const cells = table.querySelectorAll(`th:nth-child(${colIndex + 1}), td:nth-child(${colIndex + 1})`);
  
  cells.forEach(cell => {
    cell.style.display = show ? '' : 'none';
  });
}

// Modal functionality
document.addEventListener('DOMContentLoaded', function() {
  const openBtn = document.getElementById('open-agent-config');
  const backdrop = document.getElementById('qs-agentcfg-backdrop');
  const modal = document.getElementById('qs-agentcfg-modal');
  const closeEls = document.querySelectorAll('[data-qs-close]');
  const fileInput = document.getElementById('agent_config_file');
  const chooseBtn = document.getElementById('qs-choose-file');
  const resetBtn = document.getElementById('qs-reset');
  const form = document.getElementById('qs-agentcfg-form');
  const filenameSpan = document.getElementById('qs-filename');

  function openModal() {
    if (backdrop && modal) {
      backdrop.style.display = 'block';
      modal.style.display = 'flex';
    }
  }
  
  function closeModal() {
    if (backdrop && modal) {
      backdrop.style.display = 'none';
      modal.style.display = 'none';
    }
  }

  if (openBtn) openBtn.addEventListener('click', openModal);
  closeEls.forEach(el => el.addEventListener('click', closeModal));
  if (backdrop) backdrop.addEventListener('click', closeModal);

  if (chooseBtn) chooseBtn.addEventListener('click', () => fileInput.click());
  if (fileInput) {
    fileInput.addEventListener('change', function() {
      filenameSpan.textContent = fileInput.files.length ? fileInput.files[0].name : 'No file chosen';
    });
  }
  if (resetBtn) {
    resetBtn.addEventListener('click', function(e) {
      e.preventDefault();
      form.reset();
      filenameSpan.textContent = 'No file chosen';
    });
  }
});

// Add filter row functionality
document.addEventListener('click', function(e) {
  if (e.target.closest('.add-filter-btn')) {
    e.preventDefault();
    const container = document.getElementById('filters-container');
    const firstRow = container.querySelector('.filter-row');
    const newRow = firstRow.cloneNode(true);
    
    newRow.querySelectorAll('select, input').forEach(el => {
      if (el.tagName === 'INPUT') el.value = '';
      if (el.tagName === 'SELECT') el.selectedIndex = 0;
    });
    
    container.appendChild(newRow);
  }
});

// CSV Download functionality
function downloadCSV() {
  const table = document.querySelector('#result_list');
  if (!table) return;
  
  const rows = [];
  const headerCells = table.querySelectorAll('thead th');
  const header = [];
  
  headerCells.forEach(cell => {
    if (cell.style.display !== 'none') {
      header.push(cell.textContent.trim());
    }
  });
  rows.push(header);
  
  const bodyRows = table.querySelectorAll('tbody tr');
  bodyRows.forEach(row => {
    if (row.style.display !== 'none') {
      const rowData = [];
      const cells = row.querySelectorAll('td, th');
      cells.forEach(cell => {
        if (cell.style.display !== 'none') {
          rowData.push(cell.textContent.trim());
        }
      });
      rows.push(rowData);
    }
  });
  
  const csvContent = rows.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'table_data.csv';
  a.click();
  window.URL.revokeObjectURL(url);
}
</script>
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<style>
  /* two-column layout: main list + sidebar */
  .qs-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
  }
  @media (min-width: 1100px) {
    .qs-grid {
      grid-template-columns: 1fr 320px;
      align-items: start;
    }
  }
  .qs-sidebar {
    position: sticky;
    top: 1rem;
    padding: 12px;
    border: 1px solid var(--hairline-color, #e5e5e5);
    border-radius: 8px;
    background: var(--body-bg, #fff);
  }
  .filter-pair { display: grid; gap: 6px; margin-bottom: 8px; }
  .filter-pair select, .filter-pair input { width: 100%; }
  .qs-actions { display: flex; gap: 8px; margin-top: 8px; }

  /* Enhanced filter styles */
  .column-selector-panel {
    background: var(--body-bg, #fff);
    /* border: 1px solid var(--hairline-color, #e5e5e5);
    border-radius: 8px; */
    /* padding: 16px; */
  }
  .filter-row {
    display: flex;
    gap: 8px;
    margin-bottom: 10px;
  }
  .filter-column, .filter-operator, .filter-value {
    flex: 1;
    padding: 6px 8px;
    border: 1px solid var(--hairline-color, #ddd);
    border-radius: 4px;
    width: 138px;
  }
  .add-filter-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 6px;
    border-radius: 4px;
  }
  .add-filter-btn:hover { background: rgba(0,0,0,0.05); }
  .column-checkboxes { margin: 16px 0; }
  .column-checkboxes label {
    display: block;
    margin-bottom: 8px;
    cursor: pointer;
  }
  .select-all-label {
    font-weight: bold;
    padding-bottom: 8px;
    margin-bottom: 12px !important;
  }
  .action-buttons {
    display: flex;
    gap: 8px;
    margin-top: 16px;
  }
  .action-buttons button {
    padding: 8px 16px;
    border: 1px solid var(--hairline-color, #ddd);
    border-radius: 4px;
    background: var(--body-bg, #fff);
    cursor: pointer;
    width: 242px;
  }
  .action-buttons button:hover { background: rgba(0,0,0,0.05); }
  #apply-filters {
    background: #035289 !important;
    color: white !important;
  }

  /* Hide default Django filters */
  #changelist-filter { display: none !important; }

  /* Modal base */
  .qs-modal-backdrop {
    display: none;
    position: fixed; inset: 0; background: rgba(0,0,0,0.45);
    z-index: 1000;
  }
  .qs-modal {
    position: fixed; inset: 0; display: none;
    align-items: center; justify-content: center; z-index: 1001;
  }
  .qs-modal-content {
    width: min(720px, 92vw);
    background: var(--body-bg, #fff);
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.18);
    overflow: hidden;
  }
  .qs-modal-header {
    padding: 16px 20px; font-weight: 600; font-size: 16px;
    border-bottom: 1px solid var(--hairline-color, #e5e5e5);
  }
  .qs-modal-body { padding: 16px 20px; }
  .qs-modal-footer {
    display:flex; gap:10px; justify-content:flex-end; padding: 12px 20px 16px;
    border-top: 1px solid var(--hairline-color, #e5e5e5);
  }
  .qs-alert {
    background: #FFE2E2; color: #F44336;
    border-radius: 8px; padding: 12px 14px; margin-bottom: 14px;
  }
  .qs-file-btn {
    display:flex; align-items:center; gap:8px;
    border: 1px solid var(--hairline-color, #dcdcdc);
    border-radius: 8px; padding: 10px 12px; cursor: pointer;
    background: var(--body-bg, #fff);
  }
  .qs-file-btn:hover { background: rgba(0,0,0,0.03); }
  .qs-hidden { display:none; }
</style>
{% endblock %}

{% block search %}
<div style="display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px; width: 100%;">
  {{ block.super }}
  <div class="flex gap-2">
    <button type="button" onclick="downloadCSV()" class="button" 
      style="padding: 8px 16px;
        border: 1px solid var(--hairline-color, #ddd);
        border-radius: 4px;
        background: var(--body-bg, #fff);
        cursor: pointer;"
    >
      <div class="flex justify-center items-center gap-2">
      
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M6 8.68125C5.9 8.68125 5.80625 8.66562 5.71875 8.63437C5.63125 8.60312 5.55 8.55 5.475 8.475L2.775 5.775C2.625 5.625 2.55313 5.45 2.55938 5.25C2.56563 5.05 2.6375 4.875 2.775 4.725C2.925 4.575 3.10312 4.49688 3.30937 4.49063C3.51562 4.48438 3.69375 4.55625 3.84375 4.70625L5.25 6.1125V0.75C5.25 0.5375 5.32188 0.359375 5.46562 0.215625C5.60938 0.071875 5.7875 0 6 0C6.2125 0 6.39063 0.071875 6.53438 0.215625C6.67813 0.359375 6.75 0.5375 6.75 0.75V6.1125L8.15625 4.70625C8.30625 4.55625 8.48438 4.48438 8.69063 4.49063C8.89688 4.49688 9.075 4.575 9.225 4.725C9.3625 4.875 9.43438 5.05 9.44063 5.25C9.44688 5.45 9.375 5.625 9.225 5.775L6.525 8.475C6.45 8.55 6.36875 8.60312 6.28125 8.63437C6.19375 8.66562 6.1 8.68125 6 8.68125ZM1.5 12C1.0875 12 0.734375 11.8531 0.440625 11.5594C0.146875 11.2656 0 10.9125 0 10.5V9C0 8.7875 0.071875 8.60938 0.215625 8.46563C0.359375 8.32188 0.5375 8.25 0.75 8.25C0.9625 8.25 1.14062 8.32188 1.28437 8.46563C1.42813 8.60938 1.5 8.7875 1.5 9V10.5H10.5V9C10.5 8.7875 10.5719 8.60938 10.7156 8.46563C10.8594 8.32188 11.0375 8.25 11.25 8.25C11.4625 8.25 11.6406 8.32188 11.7844 8.46563C11.9281 8.60938 12 8.7875 12 9V10.5C12 10.9125 11.8531 11.2656 11.5594 11.5594C11.2656 11.8531 10.9125 12 10.5 12H1.5Z"
            fill="#4A5565" />
        </svg>
        <span>
          DOWNLOAD CSV
        </span>
      </div>
    </button>
    {% if opts.model_name == 'post' %}
    <a href="post-config/" class="button" style="background: #035289; color: white; padding: 8px 15px; text-decoration: none; border-radius: 4px; font-size: 13px;">
      Post Config
    </a>
    {% endif %}
    <button type="button" id="open-agent-config" class="button" style="background: #035289; color: white; padding: 8px 15px; text-decoration: none; border-radius: 4px; font-size: 13px; border: none; cursor: pointer;">
      <div class="flex justify-center items-center gap-2">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
         <path d="M7.11874 15.5C6.78124 15.5 6.49061 15.3875 6.24686 15.1625C6.00311 14.9375 5.85624 14.6625 5.80624 14.3375L5.63749 13.1C5.47499 13.0375 5.32186 12.9625 5.17811 12.875C5.03436 12.7875 4.89374 12.6938 4.75624 12.5938L3.59374 13.0812C3.28124 13.2188 2.96874 13.2313 2.65624 13.1188C2.34374 13.0063 2.09999 12.8062 1.92499 12.5187L1.04374 10.9813C0.868735 10.6938 0.818735 10.3875 0.893735 10.0625C0.968735 9.7375 1.13749 9.46875 1.39999 9.25625L2.39374 8.50625C2.38124 8.41875 2.37499 8.33438 2.37499 8.25313V7.74688C2.37499 7.66563 2.38124 7.58125 2.39374 7.49375L1.39999 6.74375C1.13749 6.53125 0.968735 6.2625 0.893735 5.9375C0.818735 5.6125 0.868735 5.30625 1.04374 5.01875L1.92499 3.48125C2.09999 3.19375 2.34374 2.99375 2.65624 2.88125C2.96874 2.76875 3.28124 2.78125 3.59374 2.91875L4.75624 3.40625C4.89374 3.30625 5.03749 3.2125 5.18749 3.125C5.33749 3.0375 5.48749 2.9625 5.63749 2.9L5.80624 1.6625C5.85624 1.3375 6.00311 1.0625 6.24686 0.8375C6.49061 0.6125 6.78124 0.5 7.11874 0.5H8.88124C9.21873 0.5 9.50936 0.6125 9.75311 0.8375C9.99686 1.0625 10.1437 1.3375 10.1937 1.6625L10.3625 2.9C10.525 2.9625 10.6781 3.0375 10.8219 3.125C10.9656 3.2125 11.1062 3.30625 11.2437 3.40625L12.4062 2.91875C12.7187 2.78125 13.0312 2.76875 13.3437 2.88125C13.6562 2.99375 13.9 3.19375 14.075 3.48125L14.9562 5.01875C15.1312 5.30625 15.1812 5.6125 15.1062 5.9375C15.0312 6.2625 14.8625 6.53125 14.6 6.74375L13.6062 7.49375C13.6187 7.58125 13.625 7.66563 13.625 7.74688V8.25313C13.625 8.33438 13.6125 8.41875 13.5875 8.50625L14.5812 9.25625C14.8437 9.46875 15.0125 9.7375 15.0875 10.0625C15.1625 10.3875 15.1125 10.6938 14.9375 10.9813L14.0375 12.5187C13.8625 12.8062 13.6187 13.0063 13.3062 13.1188C12.9937 13.2313 12.6812 13.2188 12.3687 13.0812L11.2437 12.5938C11.1062 12.6938 10.9625 12.7875 10.8125 12.875C10.6625 12.9625 10.5125 13.0375 10.3625 13.1L10.1937 14.3375C10.1437 14.6625 9.99686 14.9375 9.75311 15.1625C9.50936 15.3875 9.21873 15.5 8.88124 15.5H7.11874ZM7.24998 14H8.73124L8.99374 12.0125C9.38124 11.9125 9.74061 11.7656 10.0719 11.5719C10.4031 11.3781 10.7062 11.1438 10.9812 10.8687L12.8375 11.6375L13.5687 10.3625L11.9562 9.14375C12.0187 8.96875 12.0625 8.78438 12.0875 8.59063C12.1125 8.39688 12.125 8.2 12.125 8C12.125 7.8 12.1125 7.60313 12.0875 7.40938C12.0625 7.21563 12.0187 7.03125 11.9562 6.85625L13.5687 5.6375L12.8375 4.3625L10.9812 5.15C10.7062 4.8625 10.4031 4.62188 10.0719 4.42813C9.74061 4.23438 9.38124 4.0875 8.99374 3.9875L8.74998 2H7.26874L7.00624 3.9875C6.61874 4.0875 6.25936 4.23438 5.92811 4.42813C5.59686 4.62188 5.29374 4.85625 5.01874 5.13125L3.16249 4.3625L2.43124 5.6375L4.04374 6.8375C3.98124 7.025 3.93749 7.2125 3.91249 7.4C3.88749 7.5875 3.87499 7.7875 3.87499 8C3.87499 8.2 3.88749 8.39375 3.91249 8.58125C3.93749 8.76875 3.98124 8.95625 4.04374 9.14375L2.43124 10.3625L3.16249 11.6375L5.01874 10.85C5.29374 11.1375 5.59686 11.3781 5.92811 11.5719C6.25936 11.7656 6.61874 11.9125 7.00624 12.0125L7.24998 14ZM8.03749 10.625C8.76249 10.625 9.38124 10.3688 9.89374 9.85625C10.4062 9.34375 10.6625 8.725 10.6625 8C10.6625 7.275 10.4062 6.65625 9.89374 6.14375C9.38124 5.63125 8.76249 5.375 8.03749 5.375C7.29998 5.375 6.67811 5.63125 6.17186 6.14375C5.66561 6.65625 5.41249 7.275 5.41249 8C5.41249 8.725 5.66561 9.34375 6.17186 9.85625C6.67811 10.3688 7.29998 10.625 8.03749 10.625Z" fill="white"/>
        </svg>
        <span>
          AGENT CONFIG
        </span>
      </div>
    </button>
  </div>
</div>
{% endblock %}

{% block content %}
<div style="display: flex; gap: 20px;">
  <div style="flex: 1;">
    {{ block.super }}
  </div>
  
  <div id="column-selector-panel" class="column-selector-panel">
    <h3 class="font-medium text-black">Filters</h3>
    <div id="filters-container">
      <div class="filter-row">
        <select class="filter-column">
          <option value="">Column</option>
          {% for field in cl.list_display %}
            {% if field != "action_checkbox" %}
            <option value="{{ forloop.counter0 }}">{{ field|capfirst }}</option>
            {% endif %}
          {% endfor %}
        </select>
        <select class="filter-operator">
          <option value="include">Include</option>
          <option value="exclude">Exclude</option>
          <option value="lt">Less Than</option>
          <option value="lte">≤</option>
          <option value="gt">Greater Than</option>
          <option value="gte">≥</option>
          <option value="empty">Is Empty</option>
          <option value="not_empty">Not Empty</option>
        </select>
        <input type="text" class="filter-value" placeholder="Value" />
        <button type="button" class="add-filter-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 17H13V13H17V11H13V7H11V11H7V13H11V17ZM12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C13.3833 2 14.6833 2.2625 15.9 2.7875C17.1167 3.3125 18.175 4.025 19.075 4.925C19.975 5.825 20.6875 6.88333 21.2125 8.1C21.7375 9.31667 22 10.6167 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22ZM12 20C14.2333 20 16.125 19.225 17.675 17.675C19.225 16.125 20 14.2333 20 12C20 9.76667 19.225 7.875 17.675 6.325C16.125 4.775 14.2333 4 12 4C9.76667 4 7.875 4.775 6.325 6.325C4.775 7.875 4 9.76667 4 12C4 14.2333 4.775 16.125 6.325 17.675C7.875 19.225 9.76667 20 12 20Z" fill="#035289"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="font-medium text-black">Column Selection</div>
    <div class="column-checkboxes">
      <label class="select-all-label">
        <input type="checkbox" id="select-all-columns" checked />
        Select All
      </label>
      {% for field in cl.list_display %}
        {% if field != "action_checkbox" %}
        <label>
          <input type="checkbox" class="column-toggle" data-column="{{ forloop.counter0 }}" checked />
          {{ field|title }}
        </label>
        {% endif %}
      {% endfor %}
    </div>

    <div class="action-buttons">
      <button type="button" id="reset-filters" onclick="resetFilters()">
        <div class="flex justify-center items-center gap-2">
          <svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7.5 15.5C6.5625 15.5 5.68438 15.3219 4.86563 14.9656C4.04688 14.6094 3.33438 14.1281 2.72813 13.5219C2.12188 12.9156 1.64062 12.2031 1.28438 11.3844C0.928125 10.5656 0.75 9.68751 0.75 8.75001C0.75 8.53751 0.821875 8.35938 0.965625 8.21563C1.10938 8.07188 1.2875 8.00001 1.5 8.00001C1.7125 8.00001 1.89062 8.07188 2.03437 8.21563C2.17813 8.35938 2.25 8.53751 2.25 8.75001C2.25 10.2125 2.75937 11.4531 3.77812 12.4719C4.79688 13.4906 6.0375 14 7.5 14C8.9625 14 10.2031 13.4906 11.2219 12.4719C12.2406 11.4531 12.75 10.2125 12.75 8.75001C12.75 7.28751 12.2406 6.04688 11.2219 5.02813C10.2031 4.00938 8.9625 3.50001 7.5 3.50001H7.3875L8.025 4.13751C8.175 4.28751 8.24688 4.46251 8.24063 4.66251C8.23438 4.86251 8.1625 5.03751 8.025 5.18751C7.875 5.33751 7.69688 5.41563 7.49063 5.42188C7.28438 5.42813 7.10625 5.35626 6.95625 5.20626L5.025 3.27501C4.875 3.12501 4.8 2.95001 4.8 2.75001C4.8 2.55001 4.875 2.37501 5.025 2.22501L6.95625 0.293759C7.10625 0.143759 7.28438 0.0718838 7.49063 0.0781338C7.69688 0.0843838 7.875 0.162509 8.025 0.312509C8.1625 0.462509 8.23438 0.637509 8.24063 0.837509C8.24688 1.03751 8.175 1.21251 8.025 1.36251L7.3875 2.00001H7.5C8.4375 2.00001 9.31563 2.17813 10.1344 2.53438C10.9531 2.89063 11.6656 3.37188 12.2719 3.97813C12.8781 4.58438 13.3594 5.29688 13.7156 6.11563C14.0719 6.93438 14.25 7.81251 14.25 8.75001C14.25 9.68751 14.0719 10.5656 13.7156 11.3844C13.3594 12.2031 12.8781 12.9156 12.2719 13.5219C11.6656 14.1281 10.9531 14.6094 10.1344 14.9656C9.31563 15.3219 8.4375 15.5 7.5 15.5Z" fill="#4A5565"/>
          </svg>
          <span>
            RESET
          </span>
        </div>
      </button>
      <button type="button" id="apply-filters" onclick="applyFilters()">
        <div class="flex justify-center items-center gap-2">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.95 9.35L5.3375 7.7375C5.2 7.6 5.025 7.53125 4.8125 7.53125C4.6 7.53125 4.425 7.6 4.2875 7.7375C4.15 7.875 4.08125 8.05 4.08125 8.2625C4.08125 8.475 4.15 8.65 4.2875 8.7875L6.425 10.925C6.575 11.075 6.75 11.15 6.95 11.15C7.15 11.15 7.325 11.075 7.475 10.925L11.7125 6.6875C11.85 6.55 11.9188 6.375 11.9188 6.1625C11.9188 5.95 11.85 5.775 11.7125 5.6375C11.575 5.5 11.4 5.43125 11.1875 5.43125C10.975 5.43125 10.8 5.5 10.6625 5.6375L6.95 9.35ZM8 15.5C6.9625 15.5 5.9875 15.3031 5.075 14.9094C4.1625 14.5156 3.36875 13.9813 2.69375 13.3063C2.01875 12.6313 1.48438 11.8375 1.09063 10.925C0.696875 10.0125 0.5 9.0375 0.5 8C0.5 6.9625 0.696875 5.9875 1.09063 5.075C1.48438 4.1625 2.01875 3.36875 2.69375 2.69375C3.36875 2.01875 4.1625 1.48438 5.075 1.09063C5.9875 0.696875 6.9625 0.5 8 0.5C9.0375 0.5 10.0125 0.696875 10.925 1.09063C11.8375 1.48438 12.6313 2.01875 13.3063 2.69375C13.9813 3.36875 14.5156 4.1625 14.9094 5.075C15.3031 5.9875 15.5 6.9625 15.5 8C15.5 9.0375 15.3031 10.0125 14.9094 10.925C14.5156 11.8375 13.9813 12.6313 13.3063 13.3063C12.6313 13.9813 11.8375 14.5156 10.925 14.9094C10.0125 15.3031 9.0375 15.5 8 15.5ZM8 14C9.675 14 11.0938 13.4187 12.2563 12.2563C13.4187 11.0938 14 9.675 14 8C14 6.325 13.4187 4.90625 12.2563 3.74375C11.0938 2.58125 9.675 2 8 2C6.325 2 4.90625 2.58125 3.74375 3.74375C2.58125 4.90625 2 6.325 2 8C2 9.675 2.58125 11.0938 3.74375 12.2563C4.90625 13.4187 6.325 14 8 14Z" fill="white"/>
          </svg>

          <span>
            APPLY
          </span>
        </div>
      </button>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="qs-agentcfg-backdrop" class="qs-modal-backdrop" data-qs-close></div>
<div id="qs-agentcfg-modal" class="qs-modal" role="dialog" aria-modal="true" aria-labelledby="qs-agentcfg-title">
  <div class="qs-modal-content">
    <div class="qs-modal-header">
      <span id="qs-agentcfg-title">Agent Config</span>
      <button type="button" class="button" style="float:right;" data-qs-close>✕</button>
    </div>

    <form id="qs-agentcfg-form" method="post" enctype="multipart/form-data" action="./upload-config/">
      {% csrf_token %}
      <div class="qs-modal-body">
        <div class="qs-alert">
          If the Name of the Agents, Tools or Tool Utils already exists, unless you specifically set
          <strong>force_update: true</strong> in the YAML file, the existing Agent, Tool or Tool Util will not be updated.
        </div>

        <input id="agent_config_file" name="agent_config_file" type="file" accept=".yml,.yaml" class="qs-hidden"/>

        <button type="button" id="qs-choose-file" class="qs-file-btn" title="Choose file to upload">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <mask id="mask0_8989_151955" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="16">
              <rect width="16" height="16" fill="#D9D9D9"/>
            </mask>
            <g mask="url(#mask0_8989_151955)">
              <path d="M7.33342 10.6667V5.23334L5.60008 6.96667L4.66675 6.00001L8.00008 2.66667L11.3334 6.00001L10.4001 6.96667L8.66675 5.23334V10.6667H7.33342ZM4.00008 13.3333C3.63341 13.3333 3.31953 13.2028 3.05841 12.9417C2.7973 12.6806 2.66675 12.3667 2.66675 12V10H4.00008V12H12.0001V10H13.3334V12C13.3334 12.3667 13.2029 12.6806 12.9417 12.9417C12.6806 13.2028 12.3667 13.3333 12.0001 13.3333H4.00008Z" fill="#99A1AF"/>
            </g>
          </svg>
          <span>Choose file to upload</span>
        </button>
        <div style="margin-top:6px; font-size:12px; color:#667085;">
          <span id="qs-filename">No file chosen</span>
        </div>
      </div>

      <div class="qs-modal-footer">
        <button type="button" class="button" id="qs-reset" title = "RESET">
          <div class="flex gap-2">
            <svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7.5 15.5C6.5625 15.5 5.68438 15.3219 4.86563 14.9656C4.04688 14.6094 3.33438 14.1281 2.72813 13.5219C2.12188 12.9156 1.64062 12.2031 1.28438 11.3844C0.928125 10.5656 0.75 9.68751 0.75 8.75001C0.75 8.53751 0.821875 8.35938 0.965625 8.21563C1.10938 8.07188 1.2875 8.00001 1.5 8.00001C1.7125 8.00001 1.89062 8.07188 2.03437 8.21563C2.17813 8.35938 2.25 8.53751 2.25 8.75001C2.25 10.2125 2.75937 11.4531 3.77812 12.4719C4.79688 13.4906 6.0375 14 7.5 14C8.9625 14 10.2031 13.4906 11.2219 12.4719C12.2406 11.4531 12.75 10.2125 12.75 8.75001C12.75 7.28751 12.2406 6.04688 11.2219 5.02813C10.2031 4.00938 8.9625 3.50001 7.5 3.50001H7.3875L8.025 4.13751C8.175 4.28751 8.24688 4.46251 8.24063 4.66251C8.23438 4.86251 8.1625 5.03751 8.025 5.18751C7.875 5.33751 7.69688 5.41563 7.49063 5.42188C7.28438 5.42813 7.10625 5.35626 6.95625 5.20626L5.025 3.27501C4.875 3.12501 4.8 2.95001 4.8 2.75001C4.8 2.55001 4.875 2.37501 5.025 2.22501L6.95625 0.293759C7.10625 0.143759 7.28438 0.0718838 7.49063 0.0781338C7.69688 0.0843838 7.875 0.162509 8.025 0.312509C8.1625 0.462509 8.23438 0.637509 8.24063 0.837509C8.24688 1.03751 8.175 1.21251 8.025 1.36251L7.3875 2.00001H7.5C8.4375 2.00001 9.31563 2.17813 10.1344 2.53438C10.9531 2.89063 11.6656 3.37188 12.2719 3.97813C12.8781 4.58438 13.3594 5.29688 13.7156 6.11563C14.0719 6.93438 14.25 7.81251 14.25 8.75001C14.25 9.68751 14.0719 10.5656 13.7156 11.3844C13.3594 12.2031 12.8781 12.9156 12.2719 13.5219C11.6656 14.1281 10.9531 14.6094 10.1344 14.9656C9.31563 15.3219 8.4375 15.5 7.5 15.5Z" fill="#4A5565"/>
            </svg>
            <span>
              RESET
            </span> 
          </div>
        </button>
        <button type="submit" class="button button-primary">UPLOAD AGENT CONFIG</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block filters %}
<style>
  /* Hide default Django filters (correct CSS) */
  #changelist-filter { display: none !important; }
</style>
{% endblock %}


